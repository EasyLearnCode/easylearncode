{% extends "main.html" %}
{% block mediaCSS %}
    <link rel="stylesheet" href="/application/css/contest.css">
    <link href='http://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
    <link href="/application/css/hopscotch-0.1.1.css" rel="stylesheet">
{% endblock %}
{% block content %}
    {% raw %}
        <div class="container" data-ng-controller="ContestCtrl">
        <div class="text-center" data-ng-show="!loaded">
            <div class="row row-gap-large"><img src="/application/img/tp_loading.gif"></div>
            <div class="row row-gap-small"><h4>Đang tải dữ liệu...</h4></div>
        </div>
        <div data-ng-show="loaded">
        <div class="col-md-12 highlight">
            <div><img width="100" alt="logo" style="float: left; margin-right: 5px"
                      src="/application/img/Olympic-Flame.ico"/>
            </div>
            Xin chào mừng các bạn đến với phân hệ thi đố vui hàng tuần. Đây là nơi để các bạn luyện tập lập trình và
            tư duy thuật toán thông qua việc giải các bài tập có
            dạng tương tự như các bài thi học sinh giỏi tin học. Chúng tôi hy vọng qua việc tham gia cuộc thi, các
            bạn sẽ tìm thấy sự hứng thú trong việc học tin học, nâng cao được trình độ của mình,
            đồng thời cũng có thể giao lưu, học tập dược từ các bạn khác!<br/>
            Cuộc thi hiện đang ở tuần thứ: {{ current_week_data.week }}. <br/>
            Bắt đầu từ: {{ firstDayOfWeek | date:'dd-MM-yyyy' }} 00:00 đến {{ lastDayOfWeek | date:'dd-MM-yyyy' }} 23:59
            <a class="pull-right btn" id="startTourBtn"><img rel="tooltip" data-placement="bottom" title="Help"
                                                             alt="help"
                                                             src="/application/img/quiz/help.png"
                                                             width="50"/> </a>
        </div>
        <div class="col-md-12 highlight">
            <div class="row">
                <div class="col-md-8">
                    <h4 class="text-warning" style="float: left; margin-right: 5px;" id="step-1">Mức độ: </h4>

                    <div class="profileSteps">
                        <div ng-class="{profileStepActive:level.is_passed_level, profileStepPassive:!level.is_passed_level && !level.is_current_level }"
                             class="profileStep profileStepOne" ng-repeat="level in current_week_data.level_keys">
                            <div class="connect"></div>
                            <div class="icon" ng-class="{active:$index+1==current_level.level}">
                                <a class="btn" data-ng-click="changeCurrentLevel(level)"
                                   ng-show="level.is_passed_level || level.is_current_level ">{{ level.level }}</a>
                                <span ng-hide="level.is_passed_level || level.is_current_level">{{ level.level }}</span>
                            </div>
                        </div>

                    </div>
                    <div class="clearfix"></div>
                    <div class="panel panel-danger">
                        <div class="panel-heading">
                            <h3 class="panel-title" id="step-2">Đề bài</h3>
                        </div>
                        <div class="panel-body"
                             ng-bind-html="current_level.description_html|to_trusted">
                        </div>
                        <div class="panel-footer">
                            Thời gian giới hạn: {{ current_level.limit_time }} (s)<br/>
                            Bộ nhớ giới hạn: {{ current_level.limit_memory }} (KiB)<br/>
                            Điểm tối đa: {{ current_level.score }}<br/>
                            Mức độ: {{ current_level.level }}
                        </div>
                    </div>
                </div>
                <div class="col-md-4">

                    <label class="label label-danger" id="step-3"><span class="clock">Còn lại:
                            <timer end-time="nextfirstDayOfWeek"> {{ days }} Ngày,
                                {{ hours }} giờ,
                                {{ minutes }} phút,
                                {{ seconds }} giây
                            </timer></span>
                    </label>

                    <div class="panel panel-success">
                        <div class="panel-heading">
                            <h3 class="panel-title">Thành tích tuần này</h3>
                        </div>
                        <div class="panel-body" ng-show="current_week_data.top_player">
                            <ul class="list-group">
                                <li data-ng-repeat="player in current_week_data.top_player|limitTo:5"
                                    class="list-group-item">
                                    <span class="badge">{{ player.score|number:1 }} Điểm </span>
                                        <span title="Hạng {{ $index +1}}"
                                              ng-class="{yellow:($index)==0,blue:($index)==1}"
                                              class="glyphicon glyphicon-star"></span> {{ player.user.email }}</li>
                            </ul>
                            <a class="btn btn-success" href="/contest/result">Xem chi tiết...</a>
                        </div>
                        <div class="panel-body" ng-hide="current_week_data.top_player">
                            <p>Hãy là người đầu tiên trong bảng thành tích</p>
                        </div>
                    </div>
                    <div class="panel panel-success">
                        <div class="panel-heading">
                            <h3 class="panel-title">Kết quả của bạn</h3>
                        </div>
                        <div class="panel-body" ng-show="current_week_user_data.run_code_result">
                            <table class="table">
                                <tr data-ng-repeat="result in current_week_user_data.run_code_result|limitTo:resultQuantity">
                                    <td>
                                        {{ result.code.filename }}
                                    </td>
                                    <td>
                                        <span ng-show="result.result" class="glyphicon glyphicon-ok"></span>
                                        <span ng-hide="result.result" class="glyphicon glyphicon-remove"></span>
                                        <br/>
                                        {{ result.score|number:1 }}
                                    </td>
                                </tr>
                            </table>
                            <a href="/contest/result/user" class="btn btn-success">
                                <i class="fa fa-info-circle"></i> Xem Thêm...
                            </a>
                            <!--button class="btn btn-success" data-ng-click="pre_result()"><span class="glyphicon glyphicon-circle-arrow-up"></span></button-->
                        </div>
                        <div class="panel-body" ng-hide="current_week_user_data.run_code_result">
                            <p>Bạn chưa nộp bài lần nào</p>
                        </div>
                        <div class="panel-footer">
                            <span ng-show="current_week_user_data.rank>0">Hiện tại bạn đang xếp hạng {{ current_week_user_data.rank }} trong tuần</span>
                            <span ng-show="current_week_user_data.rank==0">Bạn chưa có hạng</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="col-xs-12 col-md-12 highlight" id="step-4">
            <tabset>
                <tab data-ng-repeat="lang in langs" heading="{{ lang.name }}" active="lang.active">
                    <div ui-ace="{ theme:'chrome',
      mode:lang.mode, onLoad: aceLoaded}" data-ng-model="lang.source">
                    </div>
                </tab>

            </tabset>
        </div>
        <div class="col-xs-12 col-md-12 highlight">
            <a rel="tooltip" data-placement="bottom" title="Nộp bài" id="step-5" class="btn btn-success pull-right"
               data-ng-click="submitCode('submit')">
                <i class="fa fa-upload"></i> </a>
            <a rel="tooltip" data-placement="bottom" title="Kiểm tra" id="step-6" class="btn btn-info"
               data-ng-click="submitCode('run')">
                <i class="fa fa-check"></i> </a>
            <a rel="tooltip" data-placement="bottom" title="Làm lại" id="step-7" class="btn btn-danger"
               data-ng-click="resetCode()">
                <i class="fa fa-refresh"></i></a>
        </div>

        <div style="height: 50px; text-align: center;" data-ng-show="compiling" id="fountainTextG">
            <div id="fountainTextG_1" class="fountainTextG">
                C
            </div>
            <div id="fountainTextG_2" class="fountainTextG">
                o
            </div>
            <div id="fountainTextG_3" class="fountainTextG">
                m
            </div>
            <div id="fountainTextG_4" class="fountainTextG">
                p
            </div>
            <div id="fountainTextG_5" class="fountainTextG">
                i
            </div>
            <div id="fountainTextG_6" class="fountainTextG">
                l
            </div>
            <div id="fountainTextG_7" class="fountainTextG">
                i
            </div>
            <div id="fountainTextG_8" class="fountainTextG">
                n
            </div>
            <div id="fountainTextG_9" class="fountainTextG">
                g
            </div>
            <div id="fountainTextG_10" class="fountainTextG">
                .
            </div>
            <div id="fountainTextG_11" class="fountainTextG">
                .
            </div>
            <div id="fountainTextG_12" class="fountainTextG">
                .
            </div>
        </div>
        <div class="col-xs-12 col-md-12 highlight" id="step-8" ng-show="isShowCompileResult">
            <h3>Kết quả chạy thử</h3>
            <table class="table">
                <tr>
                    <td>#STT</td>
                    <td>Kết quả</td>
                    <td>Thời gian(s)</td>
                    <td>Bộ nhớ(KiB)</td>
                    <td>Lỗi</td>
                </tr>
                <tr data-ng-repeat="result in compile_result">
                    <td>{{ $index+1 }}</td>
                    <td>
                        <span ng-show="result.result" class="glyphicon glyphicon-ok"></span>
                        <span ng-show="!result.result" class="glyphicon glyphicon-remove"></span>
                    </td>
                    <td>{{ result.time_used }}</td>
                    <td>{{ result.memory_used }}</td>
                    <td><span ng-show="result.error_html=='OK'" class="glyphicon glyphicon-ok"></span>
                        <span ng-show="result.error_html!='OK'"
                              ng-bind-html="result.error_html|to_trusted">{{ result.error_html }}</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="5">{{ next_level_key }}</td>
                </tr>
            </table>

        </div>
        </div>
        </div>

        <div data-backdrop='static' data-keyboard='false' class="modal fade" id="noContestModal" tabindex="-1"
             role="dialog"
             aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Thông báo</h4>
                    </div>
                    <div class="modal-body">
                        Chưa có đề thi. Xin vui lòng quay lại sau!
                    </div>
                    <div class="modal-footer">
                        <a href="/" class="btn btn-primary btn-lg">OK</a>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <!-- Modal -->
        <div data-backdrop='static' data-keyboard='false' class="modal fade" id="codeEmptyModal" tabindex="-1"
             role="dialog"
             aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Thông báo</h4>
                    </div>
                    <div class="modal-body">
                        Bạn vui lòng làm bài trước khi nộp hoặc chạy thử !!!
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary btn-lg" data-dismiss="modal">OK</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div><!-- /.modal -->


    {% endraw %}
{% endblock %}
{% block pluginJS %}
    <script src="//ace.c9.io/build/src-noconflict/ace.js"></script>
    <script src="//ace.c9.io/build/src-noconflict/ext-language_tools.js"></script>
    <script src="/application/js/libs/angularjs/ui-ace.min.js"></script>
    <script src="/application/js/libs/angularjs/ui-bootstrap-tpls-0.7.0.min.js"></script>
    <script src="/application/js/libs/angularjs/angular-timer.min.js"></script>
    <script src="/application/js/libs/date.js"></script>
    <script src="/application/js/hopscotch-0.1.2.min.js"></script>
    <script src="/application/js/demo.js"></script>
    <script src="//m-e-conroy.github.io/angular-dialog-service/javascripts/dialogs.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.2.0/bootbox.min.js" type="text/javascript"></script>


    <script src='/_ah/channel/jsapi'></script>
{% endblock %}
{% block mediaJS %}
    <script>
        angular.module('services.utility').constant('csrf_token', '{{ csrf_token() }}');
        angular.module('services.utility').constant('channelToken', '{{ channelToken }}');
        $(function () {
            $("[rel='tooltip']").tooltip();
        });

    </script>
{% endblock %}